from django.db import IntegrityError
from django.http import HttpResponseRedirect, HttpResponseServerError
from django.shortcuts import render
from django.shortcuts import HttpResponse
from django.views.decorators.csrf import csrf_exempt

from ec import models


# Create your views here.


def index(request):
    # request.POST
    # request.GET
    # return HttpResponse("Hello word")
    # if "/index/" == request.path:
    #     return find_all_tables(request)
    # if "/index/createTable" == request.path:
    #     return create_table(request)
    # return HttpResponse("something wrong")
    tables = models.ExcelTable.objects.all()
    return render(request, "index.html", {"tables": tables})


def edit_table(request):
    tid = request.POST.get("id")
    title = request.POST.get("title")
    presentation = request.POST.get("presentation")
    try:
        if "" == tid:
            table = models.ExcelTable.objects.create(name=title, presentation=presentation)
        else:
            table = models.ExcelTable.objects.get(id=tid)
            table.name = title
            table.presentation = presentation
        table.save()
        return HttpResponse("ok")
    except IntegrityError as msg:
        return HttpResponse(msg)


def delete_table(request, tabid):
    try:
        table = models.ExcelTable.objects.get(id=tabid)
        models.TableData.objects.filter(excelTable_id=tabid).delete()
        table.delete()
        return HttpResponse("ok")
    except Exception as msg:
        return HttpResponse(msg)


def view_table(request):
    tabid = request.GET.get("tabid")
    tds = models.TableData.objects.filter(excelTable_id=tabid).order_by("-lastUpdate")
    if tds.exists():
        td = tds.first()
        return render(request, "table.html", {"tabid": tabid, "tableData": td.data })
    else:
        data = """<tbody><tr id="tableHead"><th id="rowNumber">#</th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>H</th><th>I</th><th>J</th><th>K</th><th>L</th><th>M</th><th>N</th><th>O</th><th>P</th><th>Q</th><th>R</th><th>S</th><th>T</th><th>U</th><th>V</th><th>W</th><th>X</th><th>Y</th><th>Z</th></tr></tbody><tbody id="tableBody"><tr><td rowindex="0" columnindex="@">0</td><td rowindex="0" columnindex="A"></td><td rowindex="0" columnindex="B"></td><td rowindex="0" columnindex="C"></td><td rowindex="0" columnindex="D"></td><td rowindex="0" columnindex="E"></td><td rowindex="0" columnindex="F"></td><td rowindex="0" columnindex="G"></td><td rowindex="0" columnindex="H"></td><td rowindex="0" columnindex="I"></td><td rowindex="0" columnindex="J"></td><td rowindex="0" columnindex="K"></td><td rowindex="0" columnindex="L"></td><td rowindex="0" columnindex="M"></td><td rowindex="0" columnindex="N"></td><td rowindex="0" columnindex="O"></td><td rowindex="0" columnindex="P"></td><td rowindex="0" columnindex="Q"></td><td rowindex="0" columnindex="R"></td><td rowindex="0" columnindex="S"></td><td rowindex="0" columnindex="T"></td><td rowindex="0" columnindex="U"></td><td rowindex="0" columnindex="V"></td><td rowindex="0" columnindex="W"></td><td rowindex="0" columnindex="X"></td><td rowindex="0" columnindex="Y"></td><td rowindex="0" columnindex="Z"></td></tr><tr><td rowindex="1" columnindex="@">1</td><td rowindex="1" columnindex="A"></td><td rowindex="1" columnindex="B"></td><td rowindex="1" columnindex="C"></td><td rowindex="1" columnindex="D"></td><td rowindex="1" columnindex="E"></td><td rowindex="1" columnindex="F"></td><td rowindex="1" columnindex="G"></td><td rowindex="1" columnindex="H"></td><td rowindex="1" columnindex="I"></td><td rowindex="1" columnindex="J"></td><td rowindex="1" columnindex="K"></td><td rowindex="1" columnindex="L"></td><td rowindex="1" columnindex="M"></td><td rowindex="1" columnindex="N"></td><td rowindex="1" columnindex="O"></td><td rowindex="1" columnindex="P"></td><td rowindex="1" columnindex="Q"></td><td rowindex="1" columnindex="R"></td><td rowindex="1" columnindex="S"></td><td rowindex="1" columnindex="T"></td><td rowindex="1" columnindex="U"></td><td rowindex="1" columnindex="V"></td><td rowindex="1" columnindex="W"></td><td rowindex="1" columnindex="X"></td><td rowindex="1" columnindex="Y"></td><td rowindex="1" columnindex="Z"></td></tr><tr><td rowindex="2" columnindex="@">2</td><td rowindex="2" columnindex="A"></td><td rowindex="2" columnindex="B"></td><td rowindex="2" columnindex="C"></td><td rowindex="2" columnindex="D"></td><td rowindex="2" columnindex="E"></td><td rowindex="2" columnindex="F"></td><td rowindex="2" columnindex="G"></td><td rowindex="2" columnindex="H"></td><td rowindex="2" columnindex="I"></td><td rowindex="2" columnindex="J"></td><td rowindex="2" columnindex="K"></td><td rowindex="2" columnindex="L"></td><td rowindex="2" columnindex="M"></td><td rowindex="2" columnindex="N"></td><td rowindex="2" columnindex="O"></td><td rowindex="2" columnindex="P"></td><td rowindex="2" columnindex="Q"></td><td rowindex="2" columnindex="R"></td><td rowindex="2" columnindex="S"></td><td rowindex="2" columnindex="T"></td><td rowindex="2" columnindex="U"></td><td rowindex="2" columnindex="V"></td><td rowindex="2" columnindex="W"></td><td rowindex="2" columnindex="X"></td><td rowindex="2" columnindex="Y"></td><td rowindex="2" columnindex="Z"></td></tr><tr><td rowindex="3" columnindex="@">3</td><td rowindex="3" columnindex="A"></td><td rowindex="3" columnindex="B"></td><td rowindex="3" columnindex="C"></td><td rowindex="3" columnindex="D"></td><td rowindex="3" columnindex="E"></td><td rowindex="3" columnindex="F"></td><td rowindex="3" columnindex="G"></td><td rowindex="3" columnindex="H"></td><td rowindex="3" columnindex="I"></td><td rowindex="3" columnindex="J"></td><td rowindex="3" columnindex="K"></td><td rowindex="3" columnindex="L"></td><td rowindex="3" columnindex="M"></td><td rowindex="3" columnindex="N"></td><td rowindex="3" columnindex="O"></td><td rowindex="3" columnindex="P"></td><td rowindex="3" columnindex="Q"></td><td rowindex="3" columnindex="R"></td><td rowindex="3" columnindex="S"></td><td rowindex="3" columnindex="T"></td><td rowindex="3" columnindex="U"></td><td rowindex="3" columnindex="V"></td><td rowindex="3" columnindex="W"></td><td rowindex="3" columnindex="X"></td><td rowindex="3" columnindex="Y"></td><td rowindex="3" columnindex="Z"></td></tr><tr><td rowindex="4" columnindex="@">4</td><td rowindex="4" columnindex="A"></td><td rowindex="4" columnindex="B"></td><td rowindex="4" columnindex="C"></td><td rowindex="4" columnindex="D"></td><td rowindex="4" columnindex="E"></td><td rowindex="4" columnindex="F"></td><td rowindex="4" columnindex="G"></td><td rowindex="4" columnindex="H"></td><td rowindex="4" columnindex="I"></td><td rowindex="4" columnindex="J"></td><td rowindex="4" columnindex="K"></td><td rowindex="4" columnindex="L"></td><td rowindex="4" columnindex="M"></td><td rowindex="4" columnindex="N"></td><td rowindex="4" columnindex="O"></td><td rowindex="4" columnindex="P"></td><td rowindex="4" columnindex="Q"></td><td rowindex="4" columnindex="R"></td><td rowindex="4" columnindex="S"></td><td rowindex="4" columnindex="T"></td><td rowindex="4" columnindex="U"></td><td rowindex="4" columnindex="V"></td><td rowindex="4" columnindex="W"></td><td rowindex="4" columnindex="X"></td><td rowindex="4" columnindex="Y"></td><td rowindex="4" columnindex="Z"></td></tr><tr><td rowindex="5" columnindex="@">5</td><td rowindex="5" columnindex="A"></td><td rowindex="5" columnindex="B"></td><td rowindex="5" columnindex="C"></td><td rowindex="5" columnindex="D"></td><td rowindex="5" columnindex="E"></td><td rowindex="5" columnindex="F"></td><td rowindex="5" columnindex="G"></td><td rowindex="5" columnindex="H"></td><td rowindex="5" columnindex="I"></td><td rowindex="5" columnindex="J"></td><td rowindex="5" columnindex="K"></td><td rowindex="5" columnindex="L"></td><td rowindex="5" columnindex="M"></td><td rowindex="5" columnindex="N"></td><td rowindex="5" columnindex="O"></td><td rowindex="5" columnindex="P"></td><td rowindex="5" columnindex="Q"></td><td rowindex="5" columnindex="R"></td><td rowindex="5" columnindex="S"></td><td rowindex="5" columnindex="T"></td><td rowindex="5" columnindex="U"></td><td rowindex="5" columnindex="V"></td><td rowindex="5" columnindex="W"></td><td rowindex="5" columnindex="X"></td><td rowindex="5" columnindex="Y"></td><td rowindex="5" columnindex="Z"></td></tr><tr><td rowindex="6" columnindex="@">6</td><td rowindex="6" columnindex="A"></td><td rowindex="6" columnindex="B"></td><td rowindex="6" columnindex="C"></td><td rowindex="6" columnindex="D"></td><td rowindex="6" columnindex="E"></td><td rowindex="6" columnindex="F"></td><td rowindex="6" columnindex="G"></td><td rowindex="6" columnindex="H"></td><td rowindex="6" columnindex="I"></td><td rowindex="6" columnindex="J"></td><td rowindex="6" columnindex="K"></td><td rowindex="6" columnindex="L"></td><td rowindex="6" columnindex="M"></td><td rowindex="6" columnindex="N"></td><td rowindex="6" columnindex="O"></td><td rowindex="6" columnindex="P"></td><td rowindex="6" columnindex="Q"></td><td rowindex="6" columnindex="R"></td><td rowindex="6" columnindex="S"></td><td rowindex="6" columnindex="T"></td><td rowindex="6" columnindex="U"></td><td rowindex="6" columnindex="V"></td><td rowindex="6" columnindex="W"></td><td rowindex="6" columnindex="X"></td><td rowindex="6" columnindex="Y"></td><td rowindex="6" columnindex="Z"></td></tr><tr><td rowindex="7" columnindex="@">7</td><td rowindex="7" columnindex="A"></td><td rowindex="7" columnindex="B"></td><td rowindex="7" columnindex="C"></td><td rowindex="7" columnindex="D"></td><td rowindex="7" columnindex="E"></td><td rowindex="7" columnindex="F"></td><td rowindex="7" columnindex="G"></td><td rowindex="7" columnindex="H"></td><td rowindex="7" columnindex="I"></td><td rowindex="7" columnindex="J"></td><td rowindex="7" columnindex="K"></td><td rowindex="7" columnindex="L"></td><td rowindex="7" columnindex="M"></td><td rowindex="7" columnindex="N"></td><td rowindex="7" columnindex="O"></td><td rowindex="7" columnindex="P"></td><td rowindex="7" columnindex="Q"></td><td rowindex="7" columnindex="R"></td><td rowindex="7" columnindex="S"></td><td rowindex="7" columnindex="T"></td><td rowindex="7" columnindex="U"></td><td rowindex="7" columnindex="V"></td><td rowindex="7" columnindex="W"></td><td rowindex="7" columnindex="X"></td><td rowindex="7" columnindex="Y"></td><td rowindex="7" columnindex="Z"></td></tr><tr><td rowindex="8" columnindex="@">8</td><td rowindex="8" columnindex="A"></td><td rowindex="8" columnindex="B"></td><td rowindex="8" columnindex="C"></td><td rowindex="8" columnindex="D"></td><td rowindex="8" columnindex="E"></td><td rowindex="8" columnindex="F"></td><td rowindex="8" columnindex="G"></td><td rowindex="8" columnindex="H"></td><td rowindex="8" columnindex="I"></td><td rowindex="8" columnindex="J"></td><td rowindex="8" columnindex="K"></td><td rowindex="8" columnindex="L"></td><td rowindex="8" columnindex="M"></td><td rowindex="8" columnindex="N"></td><td rowindex="8" columnindex="O"></td><td rowindex="8" columnindex="P"></td><td rowindex="8" columnindex="Q"></td><td rowindex="8" columnindex="R"></td><td rowindex="8" columnindex="S"></td><td rowindex="8" columnindex="T"></td><td rowindex="8" columnindex="U"></td><td rowindex="8" columnindex="V"></td><td rowindex="8" columnindex="W"></td><td rowindex="8" columnindex="X"></td><td rowindex="8" columnindex="Y"></td><td rowindex="8" columnindex="Z"></td></tr><tr><td rowindex="9" columnindex="@">9</td><td rowindex="9" columnindex="A"></td><td rowindex="9" columnindex="B"></td><td rowindex="9" columnindex="C"></td><td rowindex="9" columnindex="D"></td><td rowindex="9" columnindex="E"></td><td rowindex="9" columnindex="F"></td><td rowindex="9" columnindex="G"></td><td rowindex="9" columnindex="H"></td><td rowindex="9" columnindex="I"></td><td rowindex="9" columnindex="J"></td><td rowindex="9" columnindex="K"></td><td rowindex="9" columnindex="L"></td><td rowindex="9" columnindex="M"></td><td rowindex="9" columnindex="N"></td><td rowindex="9" columnindex="O"></td><td rowindex="9" columnindex="P"></td><td rowindex="9" columnindex="Q"></td><td rowindex="9" columnindex="R"></td><td rowindex="9" columnindex="S"></td><td rowindex="9" columnindex="T"></td><td rowindex="9" columnindex="U"></td><td rowindex="9" columnindex="V"></td><td rowindex="9" columnindex="W"></td><td rowindex="9" columnindex="X"></td><td rowindex="9" columnindex="Y"></td><td rowindex="9" columnindex="Z"></td></tr><tr><td rowindex="10" columnindex="@">10</td><td rowindex="10" columnindex="A"></td><td rowindex="10" columnindex="B"></td><td rowindex="10" columnindex="C"></td><td rowindex="10" columnindex="D"></td><td rowindex="10" columnindex="E"></td><td rowindex="10" columnindex="F"></td><td rowindex="10" columnindex="G"></td><td rowindex="10" columnindex="H"></td><td rowindex="10" columnindex="I"></td><td rowindex="10" columnindex="J"></td><td rowindex="10" columnindex="K"></td><td rowindex="10" columnindex="L"></td><td rowindex="10" columnindex="M"></td><td rowindex="10" columnindex="N"></td><td rowindex="10" columnindex="O"></td><td rowindex="10" columnindex="P"></td><td rowindex="10" columnindex="Q"></td><td rowindex="10" columnindex="R"></td><td rowindex="10" columnindex="S"></td><td rowindex="10" columnindex="T"></td><td rowindex="10" columnindex="U"></td><td rowindex="10" columnindex="V"></td><td rowindex="10" columnindex="W"></td><td rowindex="10" columnindex="X"></td><td rowindex="10" columnindex="Y"></td><td rowindex="10" columnindex="Z"></td></tr><tr><td rowindex="11" columnindex="@">11</td><td rowindex="11" columnindex="A"></td><td rowindex="11" columnindex="B"></td><td rowindex="11" columnindex="C"></td><td rowindex="11" columnindex="D"></td><td rowindex="11" columnindex="E"></td><td rowindex="11" columnindex="F"></td><td rowindex="11" columnindex="G"></td><td rowindex="11" columnindex="H"></td><td rowindex="11" columnindex="I"></td><td rowindex="11" columnindex="J"></td><td rowindex="11" columnindex="K"></td><td rowindex="11" columnindex="L"></td><td rowindex="11" columnindex="M"></td><td rowindex="11" columnindex="N"></td><td rowindex="11" columnindex="O"></td><td rowindex="11" columnindex="P"></td><td rowindex="11" columnindex="Q"></td><td rowindex="11" columnindex="R"></td><td rowindex="11" columnindex="S"></td><td rowindex="11" columnindex="T"></td><td rowindex="11" columnindex="U"></td><td rowindex="11" columnindex="V"></td><td rowindex="11" columnindex="W"></td><td rowindex="11" columnindex="X"></td><td rowindex="11" columnindex="Y"></td><td rowindex="11" columnindex="Z"></td></tr><tr><td rowindex="12" columnindex="@">12</td><td rowindex="12" columnindex="A"></td><td rowindex="12" columnindex="B"></td><td rowindex="12" columnindex="C"></td><td rowindex="12" columnindex="D"></td><td rowindex="12" columnindex="E"></td><td rowindex="12" columnindex="F"></td><td rowindex="12" columnindex="G"></td><td rowindex="12" columnindex="H"></td><td rowindex="12" columnindex="I"></td><td rowindex="12" columnindex="J"></td><td rowindex="12" columnindex="K"></td><td rowindex="12" columnindex="L"></td><td rowindex="12" columnindex="M"></td><td rowindex="12" columnindex="N"></td><td rowindex="12" columnindex="O"></td><td rowindex="12" columnindex="P"></td><td rowindex="12" columnindex="Q"></td><td rowindex="12" columnindex="R"></td><td rowindex="12" columnindex="S"></td><td rowindex="12" columnindex="T"></td><td rowindex="12" columnindex="U"></td><td rowindex="12" columnindex="V"></td><td rowindex="12" columnindex="W"></td><td rowindex="12" columnindex="X"></td><td rowindex="12" columnindex="Y"></td><td rowindex="12" columnindex="Z"></td></tr><tr><td rowindex="13" columnindex="@">13</td><td rowindex="13" columnindex="A"></td><td rowindex="13" columnindex="B"></td><td rowindex="13" columnindex="C"></td><td rowindex="13" columnindex="D"></td><td rowindex="13" columnindex="E"></td><td rowindex="13" columnindex="F"></td><td rowindex="13" columnindex="G"></td><td rowindex="13" columnindex="H"></td><td rowindex="13" columnindex="I"></td><td rowindex="13" columnindex="J"></td><td rowindex="13" columnindex="K"></td><td rowindex="13" columnindex="L"></td><td rowindex="13" columnindex="M"></td><td rowindex="13" columnindex="N"></td><td rowindex="13" columnindex="O"></td><td rowindex="13" columnindex="P"></td><td rowindex="13" columnindex="Q"></td><td rowindex="13" columnindex="R"></td><td rowindex="13" columnindex="S"></td><td rowindex="13" columnindex="T"></td><td rowindex="13" columnindex="U"></td><td rowindex="13" columnindex="V"></td><td rowindex="13" columnindex="W"></td><td rowindex="13" columnindex="X"></td><td rowindex="13" columnindex="Y"></td><td rowindex="13" columnindex="Z"></td></tr><tr><td rowindex="14" columnindex="@">14</td><td rowindex="14" columnindex="A"></td><td rowindex="14" columnindex="B"></td><td rowindex="14" columnindex="C"></td><td rowindex="14" columnindex="D"></td><td rowindex="14" columnindex="E"></td><td rowindex="14" columnindex="F"></td><td rowindex="14" columnindex="G"></td><td rowindex="14" columnindex="H"></td><td rowindex="14" columnindex="I"></td><td rowindex="14" columnindex="J"></td><td rowindex="14" columnindex="K"></td><td rowindex="14" columnindex="L"></td><td rowindex="14" columnindex="M"></td><td rowindex="14" columnindex="N"></td><td rowindex="14" columnindex="O"></td><td rowindex="14" columnindex="P"></td><td rowindex="14" columnindex="Q"></td><td rowindex="14" columnindex="R"></td><td rowindex="14" columnindex="S"></td><td rowindex="14" columnindex="T"></td><td rowindex="14" columnindex="U"></td><td rowindex="14" columnindex="V"></td><td rowindex="14" columnindex="W"></td><td rowindex="14" columnindex="X"></td><td rowindex="14" columnindex="Y"></td><td rowindex="14" columnindex="Z"></td></tr><tr><td rowindex="15" columnindex="@">15</td><td rowindex="15" columnindex="A"></td><td rowindex="15" columnindex="B"></td><td rowindex="15" columnindex="C"></td><td rowindex="15" columnindex="D"></td><td rowindex="15" columnindex="E"></td><td rowindex="15" columnindex="F"></td><td rowindex="15" columnindex="G"></td><td rowindex="15" columnindex="H"></td><td rowindex="15" columnindex="I"></td><td rowindex="15" columnindex="J"></td><td rowindex="15" columnindex="K"></td><td rowindex="15" columnindex="L"></td><td rowindex="15" columnindex="M"></td><td rowindex="15" columnindex="N"></td><td rowindex="15" columnindex="O"></td><td rowindex="15" columnindex="P"></td><td rowindex="15" columnindex="Q"></td><td rowindex="15" columnindex="R"></td><td rowindex="15" columnindex="S"></td><td rowindex="15" columnindex="T"></td><td rowindex="15" columnindex="U"></td><td rowindex="15" columnindex="V"></td><td rowindex="15" columnindex="W"></td><td rowindex="15" columnindex="X"></td><td rowindex="15" columnindex="Y"></td><td rowindex="15" columnindex="Z"></td></tr><tr><td rowindex="16" columnindex="@">16</td><td rowindex="16" columnindex="A"></td><td rowindex="16" columnindex="B"></td><td rowindex="16" columnindex="C"></td><td rowindex="16" columnindex="D"></td><td rowindex="16" columnindex="E"></td><td rowindex="16" columnindex="F"></td><td rowindex="16" columnindex="G"></td><td rowindex="16" columnindex="H"></td><td rowindex="16" columnindex="I"></td><td rowindex="16" columnindex="J"></td><td rowindex="16" columnindex="K"></td><td rowindex="16" columnindex="L"></td><td rowindex="16" columnindex="M"></td><td rowindex="16" columnindex="N"></td><td rowindex="16" columnindex="O"></td><td rowindex="16" columnindex="P"></td><td rowindex="16" columnindex="Q"></td><td rowindex="16" columnindex="R"></td><td rowindex="16" columnindex="S"></td><td rowindex="16" columnindex="T"></td><td rowindex="16" columnindex="U"></td><td rowindex="16" columnindex="V"></td><td rowindex="16" columnindex="W"></td><td rowindex="16" columnindex="X"></td><td rowindex="16" columnindex="Y"></td><td rowindex="16" columnindex="Z"></td></tr><tr><td rowindex="17" columnindex="@">17</td><td rowindex="17" columnindex="A"></td><td rowindex="17" columnindex="B"></td><td rowindex="17" columnindex="C"></td><td rowindex="17" columnindex="D"></td><td rowindex="17" columnindex="E"></td><td rowindex="17" columnindex="F"></td><td rowindex="17" columnindex="G"></td><td rowindex="17" columnindex="H"></td><td rowindex="17" columnindex="I"></td><td rowindex="17" columnindex="J"></td><td rowindex="17" columnindex="K"></td><td rowindex="17" columnindex="L"></td><td rowindex="17" columnindex="M"></td><td rowindex="17" columnindex="N"></td><td rowindex="17" columnindex="O"></td><td rowindex="17" columnindex="P"></td><td rowindex="17" columnindex="Q"></td><td rowindex="17" columnindex="R"></td><td rowindex="17" columnindex="S"></td><td rowindex="17" columnindex="T"></td><td rowindex="17" columnindex="U"></td><td rowindex="17" columnindex="V"></td><td rowindex="17" columnindex="W"></td><td rowindex="17" columnindex="X"></td><td rowindex="17" columnindex="Y"></td><td rowindex="17" columnindex="Z"></td></tr><tr><td rowindex="18" columnindex="@">18</td><td rowindex="18" columnindex="A"></td><td rowindex="18" columnindex="B"></td><td rowindex="18" columnindex="C"></td><td rowindex="18" columnindex="D"></td><td rowindex="18" columnindex="E"></td><td rowindex="18" columnindex="F"></td><td rowindex="18" columnindex="G"></td><td rowindex="18" columnindex="H"></td><td rowindex="18" columnindex="I"></td><td rowindex="18" columnindex="J"></td><td rowindex="18" columnindex="K"></td><td rowindex="18" columnindex="L"></td><td rowindex="18" columnindex="M"></td><td rowindex="18" columnindex="N"></td><td rowindex="18" columnindex="O"></td><td rowindex="18" columnindex="P"></td><td rowindex="18" columnindex="Q"></td><td rowindex="18" columnindex="R"></td><td rowindex="18" columnindex="S"></td><td rowindex="18" columnindex="T"></td><td rowindex="18" columnindex="U"></td><td rowindex="18" columnindex="V"></td><td rowindex="18" columnindex="W"></td><td rowindex="18" columnindex="X"></td><td rowindex="18" columnindex="Y"></td><td rowindex="18" columnindex="Z"></td></tr><tr><td rowindex="19" columnindex="@">19</td><td rowindex="19" columnindex="A"></td><td rowindex="19" columnindex="B"></td><td rowindex="19" columnindex="C"></td><td rowindex="19" columnindex="D"></td><td rowindex="19" columnindex="E"></td><td rowindex="19" columnindex="F"></td><td rowindex="19" columnindex="G"></td><td rowindex="19" columnindex="H"></td><td rowindex="19" columnindex="I"></td><td rowindex="19" columnindex="J"></td><td rowindex="19" columnindex="K"></td><td rowindex="19" columnindex="L"></td><td rowindex="19" columnindex="M"></td><td rowindex="19" columnindex="N"></td><td rowindex="19" columnindex="O"></td><td rowindex="19" columnindex="P"></td><td rowindex="19" columnindex="Q"></td><td rowindex="19" columnindex="R"></td><td rowindex="19" columnindex="S"></td><td rowindex="19" columnindex="T"></td><td rowindex="19" columnindex="U"></td><td rowindex="19" columnindex="V"></td><td rowindex="19" columnindex="W"></td><td rowindex="19" columnindex="X"></td><td rowindex="19" columnindex="Y"></td><td rowindex="19" columnindex="Z"></td></tr><tr><td rowindex="20" columnindex="@">20</td><td rowindex="20" columnindex="A"></td><td rowindex="20" columnindex="B"></td><td rowindex="20" columnindex="C"></td><td rowindex="20" columnindex="D"></td><td rowindex="20" columnindex="E"></td><td rowindex="20" columnindex="F"></td><td rowindex="20" columnindex="G"></td><td rowindex="20" columnindex="H"></td><td rowindex="20" columnindex="I"></td><td rowindex="20" columnindex="J"></td><td rowindex="20" columnindex="K"></td><td rowindex="20" columnindex="L"></td><td rowindex="20" columnindex="M"></td><td rowindex="20" columnindex="N"></td><td rowindex="20" columnindex="O"></td><td rowindex="20" columnindex="P"></td><td rowindex="20" columnindex="Q"></td><td rowindex="20" columnindex="R"></td><td rowindex="20" columnindex="S"></td><td rowindex="20" columnindex="T"></td><td rowindex="20" columnindex="U"></td><td rowindex="20" columnindex="V"></td><td rowindex="20" columnindex="W"></td><td rowindex="20" columnindex="X"></td><td rowindex="20" columnindex="Y"></td><td rowindex="20" columnindex="Z"></td></tr><tr><td rowindex="21" columnindex="@">21</td><td rowindex="21" columnindex="A"></td><td rowindex="21" columnindex="B"></td><td rowindex="21" columnindex="C"></td><td rowindex="21" columnindex="D"></td><td rowindex="21" columnindex="E"></td><td rowindex="21" columnindex="F"></td><td rowindex="21" columnindex="G"></td><td rowindex="21" columnindex="H"></td><td rowindex="21" columnindex="I"></td><td rowindex="21" columnindex="J"></td><td rowindex="21" columnindex="K"></td><td rowindex="21" columnindex="L"></td><td rowindex="21" columnindex="M"></td><td rowindex="21" columnindex="N"></td><td rowindex="21" columnindex="O"></td><td rowindex="21" columnindex="P"></td><td rowindex="21" columnindex="Q"></td><td rowindex="21" columnindex="R"></td><td rowindex="21" columnindex="S"></td><td rowindex="21" columnindex="T"></td><td rowindex="21" columnindex="U"></td><td rowindex="21" columnindex="V"></td><td rowindex="21" columnindex="W"></td><td rowindex="21" columnindex="X"></td><td rowindex="21" columnindex="Y"></td><td rowindex="21" columnindex="Z"></td></tr><tr><td rowindex="22" columnindex="@">22</td><td rowindex="22" columnindex="A"></td><td rowindex="22" columnindex="B"></td><td rowindex="22" columnindex="C"></td><td rowindex="22" columnindex="D"></td><td rowindex="22" columnindex="E"></td><td rowindex="22" columnindex="F"></td><td rowindex="22" columnindex="G"></td><td rowindex="22" columnindex="H"></td><td rowindex="22" columnindex="I"></td><td rowindex="22" columnindex="J"></td><td rowindex="22" columnindex="K"></td><td rowindex="22" columnindex="L"></td><td rowindex="22" columnindex="M"></td><td rowindex="22" columnindex="N"></td><td rowindex="22" columnindex="O"></td><td rowindex="22" columnindex="P"></td><td rowindex="22" columnindex="Q"></td><td rowindex="22" columnindex="R"></td><td rowindex="22" columnindex="S"></td><td rowindex="22" columnindex="T"></td><td rowindex="22" columnindex="U"></td><td rowindex="22" columnindex="V"></td><td rowindex="22" columnindex="W"></td><td rowindex="22" columnindex="X"></td><td rowindex="22" columnindex="Y"></td><td rowindex="22" columnindex="Z"></td></tr><tr><td rowindex="23" columnindex="@">23</td><td rowindex="23" columnindex="A"></td><td rowindex="23" columnindex="B"></td><td rowindex="23" columnindex="C"></td><td rowindex="23" columnindex="D"></td><td rowindex="23" columnindex="E"></td><td rowindex="23" columnindex="F"></td><td rowindex="23" columnindex="G"></td><td rowindex="23" columnindex="H"></td><td rowindex="23" columnindex="I"></td><td rowindex="23" columnindex="J"></td><td rowindex="23" columnindex="K"></td><td rowindex="23" columnindex="L"></td><td rowindex="23" columnindex="M"></td><td rowindex="23" columnindex="N"></td><td rowindex="23" columnindex="O"></td><td rowindex="23" columnindex="P"></td><td rowindex="23" columnindex="Q"></td><td rowindex="23" columnindex="R"></td><td rowindex="23" columnindex="S"></td><td rowindex="23" columnindex="T"></td><td rowindex="23" columnindex="U"></td><td rowindex="23" columnindex="V"></td><td rowindex="23" columnindex="W"></td><td rowindex="23" columnindex="X"></td><td rowindex="23" columnindex="Y"></td><td rowindex="23" columnindex="Z"></td></tr></tbody>"""
        return render(request, "table.html", {"tabid": tabid, "tableData": data})


@csrf_exempt
def update_table_data(request):
    try:
        tabid = request.POST.get("tabid")
        tableData = request.POST.get("tableData")
        tds = models.TableData.objects.filter(excelTable_id=tabid).order_by("-lastUpdate")
        if tds.exists():
            td = tds.first()
        else:
            td = tds.create(excelTable_id=tabid)
        td.data = tableData
        td.save()
        return HttpResponse("ok")
    except Exception as msg:
        return HttpResponse(msg)
